# Design Document

## Instructions

## CurrencyPal

## 1. Problem Statement

Our company needs a tool to be able to quickly send or receive various currencies.  This tool will be used by our bank tellers to help facilitate transactions for our customers.

## 2. Top Questions to Resolve in Review

1. Extra features?
2. How are we going to structure our database?
3. 

## 3. Use Cases

U1. As a CurrencyPal bank teller, I want to quickly and efficiently find exchange rates when I know the set amount I would like to exchange.

U2. As a CurrencyPal bank teller, I want to be able to create a transaction to convert a specific amount of money from one currency to another for a specific user.

U3. As a CurrencyPal bank teller, I want to look up transaction history by customerID.

U4. As a CurrencyPal bank teller, I want to view the transaction history by currency.

U5. As a CurrencyPal bank teller, I want to be able to schedule automatic transaction for customers based on a specific exchange.

U6. As a CurrencyPal bank teller, I want to be able to help customers transfer money to each other, in a designated currency.

## 4. Project Scope


### 4.1. In Scope

* Getting the most current currency exchange rates
* Be able to exchange currency and update personal balance
* View transaction history by customerId
* View transaction history by currency
* View the history of a currency's exchange rate


### 4.2. Out of Scope

* Using a scheduler to update the exchange rate cache
* Using a scheduler to do automatic conversions based on exchange rate
* The ability to send and request money from customer to customer
* The ability to send alerts to customers based on the current exchange rate

# 5. Proposed Architecture Overview
This initial iteration will provide the minimum lovable product (MLP) including the ability to view currency exchange rates, execute exchanges, and viewing transaction history through various filters.

We will use API Gateway and Lambda to create 5 endpoints (GetCurrency, UpdateCurrency, GetTransaction, UpdateTransaction, CreateTransaction) that will handle the creation, updating and retrieval of our transactions and exchange rates.

We will retrieve the initial exchange rates from [freecurrencyapi](https://freecurrencyapi.com/) and store those in a table in DynamoDB.  We will then reference that table whenever we do our conversions.  We will have a button on our website for our users to use to update the rates to their most current state.  The button will use our DynamoDB table if it has been less then 12 hours otherwise it will use our API endpoints to update the exchange rates (Updating to an automated scheduler is currently out of scope).

We will be using tables in DynamoDB to store all of our transaction history and our customer data.

[See PlantUML](currencyConverterCD.puml) for more details.


# 6. API

## 6.1. Public Models


```
// CurrencyModel

double currentRate;
CurrencyAbrv currencyAbrv;
CountryName countryName;
int ranking;

// TransactionModel

String transactionId;
Currency currencyTo;
Currency currencyFrom;
Customer customer;
double amountToConvert;
double convertedAmount;
double conversionRate;
boolean isShown;

// CustomerModel

String customerId;
String Name;
String DOB;
Map<Currency, double> balance;
```


## 6.2. Get Currency Endpoint
* Accepts `GET` requests to `/currency/:currency`
* Accepts the currency  and returns currentRate.
    * If the given currency is not found, will throw a
      `CurrencyNotFoundException`

## 6.3. Update Currency Endpoint
* Accepts `PUT` requests to `/currency/:currency`
* Accepts data to update a Currency, including the updated double currentRate and int ranking.
  * if the currency name is not found, will throw a `CurrencyNotFoundException`
  
## 6.4. Get Transaction Endpoint
* Accepts `GET` requests to `/transaction/:transactionId`
* Accepts a transactionId and returns the corresponding Transaction
   * if the transactionId is not found return `TransactionNotFoundException`

## 6.5. Create Transaction Endpoint
* Accepts a `POST` request to `/transaction/`
* Accepts the data to create a new transaction with a provided Currency, CustomerId, AmountToConvert, AmountConverted, ConversionRate, and IsShown.  Returns a new transaction including a unique transactionId generated by CurrencyPal.
  * if transaction could not be created return `TransactionNotFoundException` 

## 6.6. Update Transaction Endpoint
* Accepts a `PUT` request to `/transaction/:transactionId`
* Accepts data to update a Transaction, including the updated isShown and the transactionId.
   * if the transactionId is not found return `TransactionNotFoundException`

## 6.7. Get Customer Endpoint
* Accepts a `GET` request to `/customer/:customerId`
* Accepts a customerId and returns the corresponding Customer
  * if the customerID is not found return `CustomerNotFoundException`
  
## 6.8. Create Customer Endpoint
* Accepts a `POST` request to `/customer/`
* Accepts data to create a new customer with a provided Name, DOB, and Balance.  Returns a customerId generated by CurrencyPal.
    * if the customer is not created return `CustomerNotValidException`
  
## 6.9. Update Customer Endpoint
* Accepts a `PUT` request to `/customer/:customerId`
* Accepts data to update a customer, including the updated balance.
    * if the customerId is not found return `CustomerNotFoundException`

# 7. Tables

## 7.1 Currencies 
```
currencyAbrv // partitionKey, string
currentRate // number
countryName // string
ranking // number
```

## 7.2 Transactions
```
transactionId // partitionKey, string
currencyTo // string
currencyFrom // string
customer // string
amountToConvert // number
isShown // boolean
```

## 7.3 Transactions GSI
```
transactionId // string
currencyTo // partitionKey, string
currencyFrom // string
customer // rangeKey, string
amountToConvert // number
isShown // boolean
```

## 7.4 Customers
```
customerId // partitionKey, string
name // string
dob // string
Map<Currency, double> balance // ss
```
# 8. Pages

See figma link for mock ups
https://www.figma.com/file/afDeHOTDS6MTtBdTeWLQIT/Untitled?node-id=1%3A13
